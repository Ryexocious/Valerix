version: '3.8'

services:
  # Databases
  order-db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: order_db
    ports:
      - "5432:5432"
    networks:
      - valerix-net

  inventory-db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: inventory_db
    ports:
      - "5433:5432"
    networks:
      - valerix-net

  # Services
  order-service:
    build: ./order-service
    environment:
      DATABASE_URL: postgresql://user:password@order-db:5432/order_db
      INVENTORY_SERVICE_URL: http://inventory-service:3001
      PORT: 3002
    ports:
      - "3002:3002"
    depends_on:
      - order-db
      - inventory-service
    networks:
      - valerix-net

  inventory-service:
    build: ./inventory-service
    environment:
      DATABASE_URL: postgresql://user:password@inventory-db:5432/inventory_db
      PORT: 3001
    ports:
      - "3001:3001"
    depends_on:
      - inventory-db
    networks:
      - valerix-net

#   # Monitoring
#   prometheus:
#     image: prom/prometheus:latest
#     volumes:
#       - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
#     ports:
#       - "9090:9090"
#     networks:
#       - valerix-net

#   grafana:
#     image: grafana/grafana:latest
#     ports:
#       - "3000:3000"
#     environment:
#       - GF_SECURITY_ADMIN_PASSWORD=admin
#     volumes:
#       - ./grafana/provisioning:/etc/grafana/provisioning
#     networks:
#       - valerix-net

#   # Frontend (Vite Dev Server)
#   # Keeping it simple for dev: bind mount source and run dev
#   # Note: Requires 'frontend' folder to exist and have package.json
#   # We will generate frontend next.
#   frontend:
#     image: node:18-alpine
#     working_dir: /app
#     volumes:
#       - ./frontend:/app
#       - /app/node_modules
#     command: sh -c "npm install && npm run dev -- --host"
#     ports:
#       - "5173:5173"
#     environment:
#       - VITE_ORDER_API=http://localhost:3002
#       - VITE_INVENTORY_API=http://localhost:3001
#     networks:
#       - valerix-net

networks:
  valerix-net:
    driver: bridge
